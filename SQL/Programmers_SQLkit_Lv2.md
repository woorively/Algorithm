# SQL Lv.2

- **LEFT( , 숫자)
- 앞 두 글자만 따오기**

```sql
SELECT LEFT(PRODUCT_CODE, 2), COUNT(*) PRODUCTS
FROM PRODUCT
GROUP BY 1
ORDER BY 1;
```

- **CASE END**

```sql
-- 예제1
SELECT BOARD_ID, WRITER_ID, TITLE, PRICE, 
    CASE WHEN STATUS = "SALE" THEN "판매중"
    WHEN STATUS = "RESERVED" THEN "예약중"
    WHEN STATUS = "DONE" THEN "거래완료"
    END STATUS
FROM USED_GOODS_BOARD
WHERE CREATED_DATE = "2022-10-05%"
ORDER BY 1 DESC;

-- 예제2
SELECT ANIMAL_ID, NAME, 
    CASE WHEN SEX_UPON_INTAKE LIKE 'Neutered%' OR 
		SEX_UPON_INTAKE LIKE 'Spayed%' THEN 'O' 
    ELSE 'X' END
FROM ANIMAL_INS;
```

- **GROUP BY, HAVING**

```sql
-- 예제1
SELECT USER_ID, PRODUCT_ID
FROM ONLINE_SALE
GROUP BY 1, 2
HAVING COUNT(1) > 1
ORDER BY 1, 2 DESC;

-- 예제2
SELECT NAME, COUNT(*)
FROM ANIMAL_INS
WHERE NAME IS NOT NULL
GROUP BY NAME
HAVING COUNT(NAME) >= 2
ORDER BY 1;
```

- **IS NULL**

```sql
SELECT ANIMAL_TYPE, IFNULL(NAME,"No name"), SEX_UPON_INTAKE
FROM ANIMAL_INS
ORDER BY ANIMAL_ID

SELECT ANIMAL_TYPE, 
    CASE WHEN NAME IS NULL THEN "No name" ELSE NAME END, 
    SEX_UPON_INTAKE
FROM ANIMAL_INS
ORDER BY ANIMAL_ID;
```

- **hour(), month()**

```sql
-- 예제1
SELECT hour(DATETIME), count(hour(DATETIME))
FROM ANIMAL_OUTS
WHERE hour(DATETIME) BETWEEN 9 AND 19
GROUP BY 1
ORDER BY 1;

-- 예제2
SELECT MCDP_CD '진료과 코드', COUNT(MCDP_CD) '5월예약건수'
FROM APPOINTMENT
WHERE MONTH(APNT_YMD) = 5
GROUP BY 1
ORDER BY 2, 1;
```

- **숫자 함수**
    - **TRUNCATE()**
    
    ```sql
    SELECT TRUNCATE(PRICE, -4) PRICE_GROUP, COUNT(*) PRODUCTS
    FROM PRODUCT
    GROUP BY 1
    ORDER BY 1;
    ```
    

[Mysql/Mariadb 숫자함수 (ABS, CEILING, FLOOR, ROUND, TRUNCATE)](https://m2seo.tistory.com/entry/MysqlMariadb-숫자함수-ABS-CEILING-FLOOR-ROUND-TRUNCATE)

- JOIN()

```sql
-- 예제1
SELECT ITEM_ID, ITEM_NAME
FROM ITEM_INFO JOIN ITEM_TREE USING(ITEM_ID)
WHERE PARENT_ITEM_ID IS NULL
ORDER BY 1;

-- 예제2
SELECT PRODUCT_CODE, AMOUNT * PRICE SALES
FROM PRODUCT JOIN 
    (SELECT PRODUCT_ID, SUM(SALES_AMOUNT) AMOUNT
    FROM OFFLINE_SALE
    GROUP BY 1) OFFLINE
    USING(PRODUCT_ID)
ORDER BY 2 DESC, 1

-- 주의!
-- Every derived table must have its own alias
-- MYSQL은 alias을 꼭 지정해줘야 한다
-- line5에 OFFLINE 없을 경우 나타나는 오류
```

- SQL TREE

```sql
SELECT S.ITEM_ID, S.ITEM_NAME, S.RARITY
FROM ITEM_INFO S, ITEM_TREE T, ITEM_INFO I
WHERE I.RARITY = 'RARE' AND 
    I.ITEM_ID = T.PARENT_ITEM_ID AND 
    S.ITEM_ID = T.ITEM_ID
ORDER BY 1 DESC;
```